workflows:
  android_production:
    name: ğŸš€ Android Production Build
    environment:
      vars:
        FLUTTER_VERSION: "3.22.2"  # Ø³ÙŠØªÙ… ÙØ±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø±
        GRADLE_VERSION: "8.1.0"
        KOTLIN_VERSION: "1.9.22"
        FIREBASE_API_KEY: $FIREBASE_API_KEY
        FIREBASE_APP_ID: $FIREBASE_APP_ID
        FIREBASE_SERVICE_ACCOUNT_JSON: $FIREBASE_SERVICE_ACCOUNT_JSON
    
    scripts:
      - name: â¬‡ï¸ ØªØ«Ø¨ÙŠØª Flutter
        script: |
          export FLUTTER_HOME="$HOME/programs/flutter_$FLUTTER_VERSION"
          rm -rf $FLUTTER_HOME  # ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø¸ÙŠÙ Ø£ÙŠ Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
          git clone https://github.com/flutter/flutter.git -b $FLUTTER_VERSION $FLUTTER_HOME
          export PATH="$FLUTTER_HOME/bin:$PATH"
          flutter config --enable-android
          flutter doctor -v

      - name: ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
        script: |
          echo "$FIREBASE_SERVICE_ACCOUNT_JSON" > /tmp/firebase_account.json
          export GOOGLE_APPLICATION_CREDENTIALS="/tmp/firebase_account.json"

      - name: ğŸ—ï¸ Ø¨Ù†Ø§Ø¡ APK
        script: |
          flutter build apk --release \
            --dart-define=FIREBASE_API_KEY=$FIREBASE_API_KEY \
            --dart-define=FIREBASE_APP_ID=$FIREBASE_APP_ID

      - name: ğŸš€ Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ Firebase
        script: |
          firebase appdistribution:distribute \
            build/app/outputs/flutter-apk/app-release.apk \
            --app $FIREBASE_APP_ID \
            --groups "testers" \
            --service-account-json /tmp/firebase_account.json
    
    artifacts:
      - build/app/outputs/**/*.apk
