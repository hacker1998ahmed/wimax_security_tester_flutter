################################################################
# WiMax Security Tester - Flutter Build Configuration
# ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ŸÑŸäÿπŸÖŸÑ ŸÖÿπ ŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
################################################################

workflows:
  android_production:
    name: Android Production Build
    environment:
      groups:
        - signing_credentials  # Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ∑ÿßÿ®ŸÇŸãÿß ÿ™ŸÖÿßŸÖŸãÿß ŸÑŸÖÿß ŸÅŸä Codemagic
        - firebase_config      # Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ∑ÿßÿ®ŸÇŸãÿß ÿ™ŸÖÿßŸÖŸãÿß ŸÑŸÖÿß ŸÅŸä Codemagic
      vars:
        PACKAGE_NAME: "com.example.wimax"  # ÿßÿ≥ÿ™ÿ®ÿØŸÑ ÿ®ÿßÿ≥ŸÖ ÿ≠ÿ≤ŸÖÿ© ÿ™ÿ∑ÿ®ŸäŸÇŸÉ
        
    scripts:
      # [1] ÿ•ÿπÿØÿßÿØ ÿ™ŸàŸÇŸäÿπ Android
      - name: üîê Prepare Keystore
        script: |
          mkdir -p android/app/keystore
          echo $ENCODED_KEYSTORE | base64 --decode > android/app/keystore/release.jks
          keytool -list -v \
            -keystore android/app/keystore/release.jks \
            -storepass $STORE_PWD \
            -alias $KEY_ALIAS

      # [2] ÿßŸÑÿ®ŸÜÿßÿ°
      - name: üõ†Ô∏è Build App Bundle
        script: |
          flutter pub get
          flutter build appbundle --release \
            --dart-define=FIREBASE_API_KEY=$FIREBASE_API_KEY \
            --dart-define=FIREBASE_APP_ID=$FIREBASE_APP_ID

    artifacts:
      - build/app/outputs/bundle/release/*.aab
